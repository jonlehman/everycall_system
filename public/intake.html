<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EveryCall Trial Intake</title>
  <link rel="stylesheet" href="/assets/app.css" />
  <style>
    .intake-shell {
      max-width: 960px;
      margin: 32px auto 48px;
      padding: 0 18px 48px;
    }
    .hero {
      display: grid;
      gap: 10px;
      margin-bottom: 18px;
    }
    .brand {
      font-weight: 700;
      letter-spacing: .02em;
      text-transform: lowercase;
      font-size: 20px;
    }
    .brand span { opacity: .6; font-weight: 500; }
    .headline {
      font-size: 32px;
      line-height: 1.1;
      margin: 0;
    }
    .subhead {
      font-size: 15px;
      color: #475569;
      max-width: 64ch;
    }
    .intake-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 18px;
    }
    .intake-card {
      padding: 22px;
      border-radius: 18px;
      border: 1px solid #e2e8f0;
      background: #fff;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.08);
    }
    .intake-card h1 { margin: 0 0 6px; }
    .intake-card p { margin: 0 0 14px; }
    .stack { display: grid; gap: 10px; }
    .stack label { font-size: 11px; text-transform: uppercase; color: #64748b; letter-spacing: .12em; }
    .stack input, .stack select, .stack textarea {
      width: 100%;
      border: 1px solid #dbe3ee;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 14px;
      font-family: inherit;
    }
    .stack textarea { min-height: 96px; resize: vertical; }
    .actions { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .muted { color: #64748b; font-size: 13px; }
    .section-title { font-size: 12px; text-transform: uppercase; letter-spacing: .18em; color: #0f172a; margin-top: 6px; }
    .full { grid-column: 1 / -1; }
    .progress {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin: 14px 0 18px;
    }
    .progress span {
      height: 6px;
      border-radius: 999px;
      background: #e2e8f0;
    }
    .progress span.active {
      background: #0f172a;
    }
    .page-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 2px;
    }
    .page-hint {
      font-size: 13px;
      color: #64748b;
      margin-bottom: 8px;
    }
    .tag-button.btn {
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      color: #0f172a;
    }
    .tag-button.btn:hover { background: #e2e8f0; }
    body {
      background: radial-gradient(circle at top, #f8fafc 0%, #eef2f7 52%, #e2e8f0 100%);
    }
    @media (max-width: 780px) {
      .intake-grid { grid-template-columns: 1fr; }
      .headline { font-size: 26px; }
    }
  </style>
</head>
<body>
  <div class="intake-shell">
    <div class="hero">
      <div class="brand">everycall <span>intake</span></div>
      <h1 class="headline">Launch your 24/7 call assistant in minutes.</h1>
      <div class="subhead">This short intake configures your AI receptionist, FAQs, routing, and onboarding defaults so you can start your free trial right away.</div>
    </div>
    <div class="card intake-card">
      <h1>Free Trial Intake</h1>
      <p class="muted">Tell us about your service business so we can configure EveryCall for you.</p>
      <div class="progress" aria-hidden="true">
        <span id="progressOne" class="active"></span>
        <span id="progressTwo"></span>
      </div>
      <form id="intakeForm" class="stack">
        <div id="page1" class="stack">
          <div class="page-title">Step 1 — Business basics</div>
          <div class="page-hint">We use this to set your workspace defaults and onboarding profile.</div>
          <div class="section-title">Business Basics</div>
          <div class="intake-grid">
            <div class="stack">
              <label>Business Name</label>
              <input id="businessName" required placeholder="Acme Plumbing" />
            </div>
            <div class="stack">
              <label>Industry</label>
              <select id="industry" required>
                <option value="">Select industry</option>
                <option value="cleaning">Cleaning</option>
                <option value="electrical">Electrical</option>
                <option value="garage_door">Garage Door</option>
                <option value="general_contractor">General Contractor</option>
                <option value="hvac">HVAC</option>
                <option value="landscaping">Landscaping</option>
                <option value="locksmith">Locksmith</option>
                <option value="pest_control">Pest Control</option>
                <option value="plumbing">Plumbing</option>
                <option value="roofing">Roofing</option>
                <option value="window_installers">Window Installers</option>
              </select>
            </div>
            <div class="stack">
              <label>Phone</label>
              <input id="phone" placeholder="+1 555 555 5555" />
            </div>
          </div>
          <div class="section-title">Business Address</div>
          <div class="intake-grid">
            <div class="stack full">
              <label>Address Line 1</label>
              <input id="address1" placeholder="123 Main St" />
            </div>
            <div class="stack full">
              <label>Address Line 2</label>
              <input id="address2" placeholder="Suite 200" />
            </div>
            <div class="stack">
              <label>City</label>
              <input id="city" placeholder="Seattle" />
            </div>
            <div class="stack">
              <label>State</label>
              <input id="state" placeholder="WA" />
            </div>
            <div class="stack">
              <label>ZIP</label>
              <input id="zip" placeholder="98101" />
            </div>
            <div class="stack full">
              <label>Service Area</label>
              <input id="serviceArea" placeholder="Seattle + Eastside" />
            </div>
          </div>
          <div class="section-title">Owner & Ops</div>
          <div class="intake-grid">
            <div class="stack">
              <label>Owner Name</label>
              <input id="ownerName" required placeholder="Jane Smith" />
            </div>
            <div class="stack">
              <label>Owner Email (Username)</label>
              <input id="ownerEmail" type="email" required placeholder="jane@acme.com" />
            </div>
            <div class="stack">
              <label>Timezone</label>
              <select id="timezone">
                <option value="America/New_York">Eastern (ET)</option>
                <option value="America/Chicago">Central (CT)</option>
                <option value="America/Denver">Mountain (MT)</option>
                <option value="America/Phoenix">Arizona (MST)</option>
                <option value="America/Los_Angeles">Pacific (PT)</option>
                <option value="America/Anchorage">Alaska (AK)</option>
                <option value="Pacific/Honolulu">Hawaii (HST)</option>
              </select>
            </div>
            <div class="stack">
              <label>Business Hours</label>
              <input id="businessHours" placeholder="Mon-Fri 8 AM - 6 PM" />
            </div>
          </div>
          <div class="actions">
            <button class="btn brand" type="button" id="nextPage">Continue</button>
          </div>
        </div>

        <div id="page2" class="stack" style="display:none;">
          <div class="page-title">Step 2 — Call handling preferences</div>
          <div class="page-hint">These settings help EveryCall build the right FAQ and intake prompts.</div>
          <div class="section-title">Call Volume</div>
          <div class="intake-grid">
            <div class="stack">
              <label>Average Calls Per Day</label>
              <input id="avgCalls" type="number" min="0" placeholder="10" />
            </div>
            <div class="stack">
              <label>Emergency Services?</label>
              <select id="emergencyServices">
                <option value="false">No</option>
                <option value="true">Yes</option>
              </select>
            </div>
          </div>
          <div class="section-title">Services Offered</div>
          <div class="intake-grid">
            <div class="stack full">
              <label>Services Offered</label>
              <div class="stack" style="gap:6px;">
                <input id="serviceSearch" list="serviceOptions" placeholder="Search or add a service" />
                <datalist id="serviceOptions"></datalist>
                <div class="actions">
                  <button class="btn" type="button" id="addService">Add Service</button>
                  <span class="muted" id="serviceHint">Choose from the list or add your own.</span>
                </div>
                <div id="serviceTags" class="actions" style="gap:6px;"></div>
              </div>
            </div>
          </div>
          <div class="section-title">Primary Goals</div>
          <div class="stack">
            <label>Primary Goal For EveryCall</label>
            <div class="stack" id="goalList">
              <label><input type="checkbox" value="reduce_missed_calls" /> Reduce missed calls</label>
              <label><input type="checkbox" value="improve_response_time" /> Improve response time</label>
              <label><input type="checkbox" value="book_more_jobs" /> Book more jobs</label>
              <label><input type="checkbox" value="after_hours_coverage" /> After-hours coverage</label>
              <label><input type="checkbox" value="better_dispatch" /> Better dispatching</label>
              <label><input type="checkbox" value="call_quality" /> Improve call quality</label>
            </div>
          </div>
          <div class="actions">
            <button class="btn" type="button" id="backPage">Back</button>
            <button class="btn brand" type="submit">Create Free Trial</button>
            <span class="muted" id="status">Ready.</span>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const form = document.getElementById('intakeForm');
    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');
    const nextPage = document.getElementById('nextPage');
    const backPage = document.getElementById('backPage');
    const industrySelect = document.getElementById('industry');
    const serviceSearch = document.getElementById('serviceSearch');
    const serviceOptions = document.getElementById('serviceOptions');
    const serviceTags = document.getElementById('serviceTags');
    const addService = document.getElementById('addService');

    const SERVICES_BY_INDUSTRY = {
      plumbing: ['Drain cleaning', 'Water heater repair', 'Leak detection', 'Sewer line repair', 'Fixture installation', 'Emergency plumbing'],
      window_installers: ['Window replacement', 'Glass repair', 'Energy-efficient upgrades', 'Custom windows', 'Installation estimates'],
      electrical: ['Panel upgrade', 'Outlet installation', 'Lighting', 'Wiring repair', 'EV charger install', 'Emergency electrical'],
      hvac: ['AC repair', 'Furnace repair', 'Maintenance', 'System replacement', 'Duct cleaning', 'Thermostat install'],
      roofing: ['Leak repair', 'Roof replacement', 'Inspection', 'Gutter install', 'Storm damage repair'],
      landscaping: ['Lawn care', 'Irrigation', 'Hardscaping', 'Tree trimming', 'Seasonal cleanup'],
      cleaning: ['Residential cleaning', 'Deep cleaning', 'Move-out cleaning', 'Commercial cleaning', 'Recurring service'],
      pest_control: ['Inspection', 'Extermination', 'Prevention plan', 'Rodent control', 'Termite treatment'],
      garage_door: ['Spring repair', 'Opener install', 'Door replacement', 'Sensor repair', 'Tune-up'],
      general_contractor: ['Remodeling', 'Additions', 'Kitchens', 'Bathrooms', 'Permits coordination'],
      locksmith: ['Lockout service', 'Rekeying', 'Lock installation', 'Key duplication', 'Emergency locksmith']
    };

    const selectedServices = new Set();

    function renderServiceOptions() {
      serviceOptions.innerHTML = '';
      const industry = industrySelect.value;
      (SERVICES_BY_INDUSTRY[industry] || []).forEach((item) => {
        const option = document.createElement('option');
        option.value = item;
        serviceOptions.appendChild(option);
      });
    }

    function renderServiceTags() {
      serviceTags.innerHTML = '';
      selectedServices.forEach((service) => {
        const tag = document.createElement('button');
        tag.type = 'button';
        tag.className = 'btn tag-button';
        tag.textContent = `${service} ✕`;
        tag.addEventListener('click', () => {
          selectedServices.delete(service);
          renderServiceTags();
        });
        serviceTags.appendChild(tag);
      });
    }

    function addServiceTag() {
      const value = serviceSearch.value.trim();
      if (!value) return;
      selectedServices.add(value);
      serviceSearch.value = '';
      renderServiceTags();
    }

    industrySelect.addEventListener('change', () => {
      renderServiceOptions();
      selectedServices.clear();
      renderServiceTags();
    });

    addService.addEventListener('click', addServiceTag);
    serviceSearch.addEventListener('keydown', (event) => {
      if (event.key === 'Enter') {
        event.preventDefault();
        addServiceTag();
      }
    });

    renderServiceOptions();

    function setStatus(message, tone) {
      statusEl.textContent = message;
      statusEl.style.color = tone === 'bad' ? '#dc2626' : tone === 'ok' ? '#059669' : '#64748b';
    }

    nextPage.addEventListener('click', () => {
      if (!document.getElementById('businessName').value.trim() || !industrySelect.value || !document.getElementById('ownerName').value.trim() || !document.getElementById('ownerEmail').value.trim()) {
        setStatus('Please complete required fields before continuing.', 'bad');
        return;
      }
      page1.style.display = 'none';
      page2.style.display = 'block';
      document.getElementById('progressOne').classList.remove('active');
      document.getElementById('progressTwo').classList.add('active');
      setStatus('Ready.', 'normal');
    });

    backPage.addEventListener('click', () => {
      page2.style.display = 'none';
      page1.style.display = 'block';
      document.getElementById('progressOne').classList.add('active');
      document.getElementById('progressTwo').classList.remove('active');
    });

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      setStatus('Submitting...', 'warn');

      const payload = {
        businessName: document.getElementById('businessName').value.trim(),
        industry: document.getElementById('industry').value,
        ownerName: document.getElementById('ownerName').value.trim(),
        ownerEmail: document.getElementById('ownerEmail').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        serviceArea: document.getElementById('serviceArea').value.trim(),
        address: [
          document.getElementById('address1').value.trim(),
          document.getElementById('address2').value.trim(),
          document.getElementById('city').value.trim(),
          document.getElementById('state').value.trim(),
          document.getElementById('zip').value.trim()
        ].filter(Boolean).join(', '),
        timezone: document.getElementById('timezone').value.trim() || 'America/Los_Angeles',
        businessHours: document.getElementById('businessHours').value.trim(),
        averageCallsPerDay: Number(document.getElementById('avgCalls').value || 0),
        emergencyServices: document.getElementById('emergencyServices').value === 'true',
        servicesOffered: [...selectedServices],
        primaryGoal: [...document.querySelectorAll('#goalList input[type=\"checkbox\"]:checked')].map((el) => el.value)
      };

      try {
        const resp = await fetch('/v1/tenants/onboard', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!resp.ok) {
          const msg = await resp.text();
          setStatus(msg || `Request failed (${resp.status})`, 'bad');
          return;
        }

        const data = await resp.json();
        setStatus('Trial created. Redirecting to workspace...', 'ok');
        const tenantKey = data.tenantKey || '';
        setTimeout(() => {
          window.location.href = `/client-app.html?tenantKey=${encodeURIComponent(tenantKey)}`;
        }, 1200);
      } catch (err) {
        setStatus(err.message || 'Request failed.', 'bad');
      }
    });
  </script>
</body>
</html>
